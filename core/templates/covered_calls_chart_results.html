{% extends "layouts/base.html" %}
{% load static %}
{% block title %} Summary {% endblock %}
<!-- Specific Plugin CSS goes HERE -->
{% block plugin_stylesheets %}{% endblock plugin_stylesheets %}
<!-- Specific CSS goes HERE -->
{% block stylesheets %}{% endblock stylesheets %}
{% block content %}

<form action="/covered_calls_chart/" method="POST">
  <div class="card">
    <div class="card-body">
      <h4 class="card-title">filters</h4>
      <table class="table table-bordered">
        <thead>
          <tr>
            <th> finviz_price_filter </th>
            <th> finviz_sector_filter </th>
            <th> min_stock_price </th>
            <th> max_stock_price </th>
            <th> min_itm_pc </th>
            <th> max_itm_pc </th>
            <th> min_max_profit_pc </th>
            <th> max_days_to_exp </th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>
              <select id="finviz_price_filter" name="finviz_price_filter">
                <option value="none"             {% if finviz_price_filter == "none"             %} selected {% endif %} >none      </option>
                <option value="sh_price_u1"      {% if finviz_price_filter == "sh_price_u1"      %} selected {% endif %} >under $1  </option>
                <option value="sh_price_u2"      {% if finviz_price_filter == "sh_price_u2"      %} selected {% endif %} >under $2  </option>
                <option value="sh_price_u3"      {% if finviz_price_filter == "sh_price_u3"      %} selected {% endif %} >under $3  </option>
                <option value="sh_price_u4"      {% if finviz_price_filter == "sh_price_u4"      %} selected {% endif %} >under $4  </option>
                <option value="sh_price_u5"      {% if finviz_price_filter == "sh_price_u5"      %} selected {% endif %} >under $5  </option>
                <option value="sh_price_u7"      {% if finviz_price_filter == "sh_price_u7"      %} selected {% endif %} >under $7  </option>
                <option value="sh_price_u10"     {% if finviz_price_filter == "sh_price_u10"     %} selected {% endif %} >under $10 </option>
                <option value="sh_price_u15"     {% if finviz_price_filter == "sh_price_u15"     %} selected {% endif %} >under $15 </option>
                <option value="sh_price_u20"     {% if finviz_price_filter == "sh_price_u20"     %} selected {% endif %} >under $20 </option>
                <option value="sh_price_u30"     {% if finviz_price_filter == "sh_price_u30"     %} selected {% endif %} >under $30 </option>
                <option value="sh_price_u40"     {% if finviz_price_filter == "sh_price_u40"     %} selected {% endif %} >under $40 </option>
                <option value="sh_price_u50"     {% if finviz_price_filter == "sh_price_u50"     %} selected {% endif %} >under $50 </option>
                <option value="sh_price_o1"      {% if finviz_price_filter == "sh_price_o1"      %} selected {% endif %} >over $1   </option>
                <option value="sh_price_o2"      {% if finviz_price_filter == "sh_price_o2"      %} selected {% endif %} >over $2   </option>
                <option value="sh_price_o3"      {% if finviz_price_filter == "sh_price_o3"      %} selected {% endif %} >over $3   </option>
                <option value="sh_price_o4"      {% if finviz_price_filter == "sh_price_o4"      %} selected {% endif %} >over $4   </option>
                <option value="sh_price_o5"      {% if finviz_price_filter == "sh_price_o5"      %} selected {% endif %} >over $5   </option>
                <option value="sh_price_o7"      {% if finviz_price_filter == "sh_price_o7"      %} selected {% endif %} >over $7   </option>
                <option value="sh_price_o10"     {% if finviz_price_filter == "sh_price_o10"     %} selected {% endif %} >over $10  </option>
                <option value="sh_price_o15"     {% if finviz_price_filter == "sh_price_o15"     %} selected {% endif %} >over $15  </option>
                <option value="sh_price_o20"     {% if finviz_price_filter == "sh_price_o20"     %} selected {% endif %} >over $20  </option>
                <option value="sh_price_o30"     {% if finviz_price_filter == "sh_price_o30"     %} selected {% endif %} >over $30  </option>
                <option value="sh_price_o40"     {% if finviz_price_filter == "sh_price_o40"     %} selected {% endif %} >over $40  </option>
                <option value="sh_price_o50"     {% if finviz_price_filter == "sh_price_o50"     %} selected {% endif %} >over $50  </option>
                <option value="sh_price_o60"     {% if finviz_price_filter == "sh_price_o60"     %} selected {% endif %} >over $60  </option>
                <option value="sh_price_o70"     {% if finviz_price_filter == "sh_price_o70"     %} selected {% endif %} >over $70  </option>
                <option value="sh_price_o80"     {% if finviz_price_filter == "sh_price_o80"     %} selected {% endif %} >over $80  </option>
                <option value="sh_price_o90"     {% if finviz_price_filter == "sh_price_o90"     %} selected {% endif %} >over $90  </option>
                <option value="sh_price_o100"    {% if finviz_price_filter == "sh_price_o100"    %} selected {% endif %} >over $100 </option>
                <option value="sh_price_1to5"    {% if finviz_price_filter == "sh_price_1to5"    %} selected {% endif %} >$1-5      </option>
                <option value="sh_price_1to10"   {% if finviz_price_filter == "sh_price_1to10"   %} selected {% endif %} >$1-10     </option>
                <option value="sh_price_1to20"   {% if finviz_price_filter == "sh_price_1to20"   %} selected {% endif %} >$1-20     </option>
                <option value="sh_price_5to10"   {% if finviz_price_filter == "sh_price_5to10"   %} selected {% endif %} >$5-10     </option>
                <option value="sh_price_5to20"   {% if finviz_price_filter == "sh_price_5to20"   %} selected {% endif %} >$5-20     </option>
                <option value="sh_price_5to50"   {% if finviz_price_filter == "sh_price_5to50"   %} selected {% endif %} >$5-50     </option>
                <option value="sh_price_10to20"  {% if finviz_price_filter == "sh_price_10to20"  %} selected {% endif %} >$10-20    </option>
                <option value="sh_price_10to50"  {% if finviz_price_filter == "sh_price_10to50"  %} selected {% endif %} >$10-50    </option>
                <option value="sh_price_20to50"  {% if finviz_price_filter == "sh_price_20to50"  %} selected {% endif %} >$20-50    </option>
                <option value="sh_price_50to100" {% if finviz_price_filter == "sh_price_50to100" %} selected {% endif %} >$50-100   </option>
              </select>
            </td>
            <td>
              <select id="finviz_sector_filter" name="finviz_sector_filter">
                <option value="none"                      {% if finviz_sector_filter == "none"                      %} selected {% endif %} >none                  </option>
                <option value="sec_basicmaterials"        {% if finviz_sector_filter == "sec_basicmaterials"        %} selected {% endif %} >basicmaterials        </option>
                <option value="sec_communicationservices" {% if finviz_sector_filter == "sec_communicationservices" %} selected {% endif %} >communicationservices </option>
                <option value="sec_consumercyclical"      {% if finviz_sector_filter == "sec_consumercyclical"      %} selected {% endif %} >consumercyclical      </option>
                <option value="sec_consumerdefensive"     {% if finviz_sector_filter == "sec_consumerdefensive"     %} selected {% endif %} >consumerdefensive     </option>
                <option value="sec_energy"                {% if finviz_sector_filter == "sec_energy"                %} selected {% endif %} >energy                </option>
                <option value="sec_financial"             {% if finviz_sector_filter == "sec_financial"             %} selected {% endif %} >financial             </option>
                <option value="sec_healthcare"            {% if finviz_sector_filter == "sec_healthcare"            %} selected {% endif %} >healthcare            </option>
                <option value="sec_industrials"           {% if finviz_sector_filter == "sec_industrials"           %} selected {% endif %} >industrials           </option>
                <option value="sec_realestate"            {% if finviz_sector_filter == "sec_realestate"            %} selected {% endif %} >realestate            </option>
                <option value="sec_technology"            {% if finviz_sector_filter == "sec_technology"            %} selected {% endif %} >technology            </option>
                <option value="sec_utilities"             {% if finviz_sector_filter == "sec_utilities"             %} selected {% endif %} >utilities             </option>
                <option value="sh_price_u50"              {% if finviz_sector_filter == "sh_price_u50"              %} selected {% endif %} >under                 </option>
              </select>
            </td>
            <td> <input id="min_stock_price"   type="text"     name="min_stock_price"   value="{{ min_stock_price }}" {% if finviz_price_filter != "none" %} disabled {% endif %}> </td>
            <td> <input id="max_stock_price"   type="text"     name="max_stock_price"   value="{{ max_stock_price }}" {% if finviz_price_filter != "none" %} disabled {% endif %}> </td>
            <td> <input id="min_itm_pc"        type="text"     name="min_itm_pc"        value="{{ min_itm_pc }}"> </td>
            <td> <input id="max_itm_pc"        type="text"     name="max_itm_pc"        value="{{ max_itm_pc }}"> </td>
            <td> <input id="min_max_profit_pc" type="text"     name="min_max_profit_pc" value="{{ min_max_profit_pc }}"> </td>
            <td> <input id="max_days_to_exp"   type="text"     name="max_days_to_exp"   value="{{ max_days_to_exp }}"> </td>
          </tr>
        </tbody>
      </table>
      <input type="submit" value="submit" name='submit'>
    </div>
  </div>
  {% csrf_token %}
  <!-- {{ form }} -->
  <!-- commenting graph part right now -->
  <div class="content-wrapper">
    <div class="row stretch-card">
      <div class="card">
        <div class="card-body">
          <h4 class="card-title">Line chart</h4>
          <div id="chartContainer" style="height: 500px; width: 100%;"></div>
        </div>
      </div>
    </div>
  </div>
  <div class="content-wrapper">
    <div class="row">
      <div class="col-lg-12 grid-margin stretch-card">
        <div class="card">
          <div class="card-body">
            <div class="table-responsive">
              <table class="table table-bordered">
                <thead>
                  <tr>
                    <th> symbol </th>
                    <th> curr_price </th>
                    <th> call_price </th>
                    <th> strike </th>
                    <th> exp_date </th>
                    <th> effective_cost </th>
                    <th> max_profit </th>
                    <th> max_profit_pc </th>
                  </tr>
                </thead>
                <tbody>
                  {% for row in table %}
                    <tr>
                      <td> {{ row.symbol }} </td>
                      <td> {{ row.curr_price | floatformat:2 }} </td>
                      <td> {{ row.call_price | floatformat:2 }} </td>
                      <td> {{ row.strike | floatformat:2 }} </td>
                      <td> {{ row.exp_date }} </td>
                      <td> {{ row.effective_cost | floatformat:2 }} </td>
                      <td> {{ row.max_profit | floatformat:2 }} </td>
                      <td> {{ row.max_profit_pc | floatformat:2 }} % </td>
                    </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</form>

{% endblock content %}
{% block plugin_javascripts %}
<script src="https://canvasjs.com/assets/script/canvasjs.min.js"></script>
{% endblock plugin_javascripts %}
{% block javascripts %}
<script>
  $("#finviz_price_filter").on("change", function(){
    if ($(this).val() != "none") {
      document.getElementById('min_stock_price').disabled = true;
      document.getElementById('max_stock_price').disabled = true;
    } else {
      document.getElementById('min_stock_price').disabled = false;
      document.getElementById('max_stock_price').disabled = false;
    }
  });

  window.onload = function () {
    var idx             = 0;
    var y_axis          = "{{ y_axis }}";
    var x_axis          = "{{ x_axis }}";
    var x               = {{ x              | safe }};
    var symbol          = {{ symbol         | safe }};
    var strike          = {{ strike         | safe }};
    var exp_date        = {{ exp_date       | safe }};
    var max_profit      = {{ max_profit     | safe }};
    var call_price      = {{ call_price     | safe }};
    var curr_price      = {{ curr_price     | safe }};
    var max_profit_pc   = {{ max_profit_pc  | safe }};
    var effective_cost  = {{ effective_cost | safe }};
    var scatter_data    = [{
                              type            : "scatter",
                              toolTipContent  : "sell {label} {a}c exp: {b}",
                              dataPoints      : []
                            }];
    var chart = new CanvasJS.Chart("chartContainer",
                                   {
                                     animationEnabled   : true,
                                     zoomEnabled        : true,
                                     title              : {text: "Max profit vs coverd call"},
                                     axisX              : {title:"ticker"},
                                     axisY              : {logarithmic: true, title: "Max profit percentage"},
                                     data               : scatter_data,
                                   }
                                  );
    for (idx = 0; idx < symbol.length; ++idx) {
      chart.options.data[0].dataPoints.push({
                                              label : symbol[idx],
                                              x     : x[idx],
                                              y     : max_profit_pc[idx],
                                              a     : strike[idx],
                                              b     : exp_date[idx]
                                            });
    }
    chart.render();
  }
</script>
{% endblock javascripts %}
